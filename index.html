<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ToU - Postacie</title>
  <link rel="icon" href="Character_walk.ico">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div id="header">
    <img src="Town_of_Us_logo.png" alt="Town of Us Logo" id="logo">
    <input type="text" id="search" placeholder="Szukaj postaci...">
  </div>

  <div class="horizontal-sections">
    <div id="crewmate-section" class="section-container">
      <div class="section-title">Crewmate</div>
      <div id="crewmate-roles"></div>
    </div>

    <div id="neutral-section" class="section-container">
      <div class="section-title">Neutral</div>
      <div id="neutral-roles"></div>
    </div>

    <div id="impostor-section" class="section-container">
      <div class="section-title">Impostor</div>
      <div id="impostor-roles"></div>
    </div>

    <div id="modifiers-section" class="section-container">
      <div class="section-title">Modifiers</div>
      <div id="modifier-roles"></div>
    </div>
  </div>

  <script>
    async function loadRoles() {
      const res = await fetch('characters.json');
      const rolesData = await res.json();

      for (const type in rolesData) {
        const container = document.getElementById(`${type}-roles`);
        rolesData[type].forEach(role => {
          const character = document.createElement("div");
          character.classList.add("character");
          character.setAttribute("data-role", type);

          const header = document.createElement("div");
          header.classList.add("character-header");
          header.onclick = () => toggleContent(header);

          const title = document.createElement("div");
          title.classList.add("character-title");
          title.textContent = `${role.name} - ${role.desc}`;

          const arrow = document.createElement("div");
          arrow.classList.add("arrow");
          arrow.textContent = "â–¶";

          header.appendChild(title);
          if (role.details.length > 0) header.appendChild(arrow);
          character.appendChild(header);

          if (role.details.length > 0) {
            const content = document.createElement("div");
            content.classList.add("character-content");
            const ul = document.createElement("ul");
            role.details.forEach(detail => {
              const li = document.createElement("li");
              li.textContent = detail;
              ul.appendChild(li);
            });
            content.appendChild(ul);
            character.appendChild(content);
          }

          container.appendChild(character);
        });
      }
    }

    function toggleContent(header) {
      const current = header.nextElementSibling;
      const arrow = header.querySelector(".arrow");
      const allContents = document.querySelectorAll(".character-content");
      const allArrows = document.querySelectorAll(".arrow");
      const isOpen = current && current.classList.contains("open");

      allContents.forEach(content => {
        if (content !== current) {
          content.style.height = "0px";
          content.classList.remove("open");
        }
      });
      allArrows.forEach(a => {
        if (a !== arrow) a.classList.remove("open");
      });

      if (current) {
        if (isOpen) {
          current.style.height = "0px";
          current.classList.remove("open");
          arrow.classList.remove("open");
        } else {
          current.classList.add("open");
          arrow.classList.add("open");
          requestAnimationFrame(() => {
            current.style.height = current.scrollHeight + "px";
          });
        }
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadRoles();
      const searchInput = document.getElementById('search');
      searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase();
        const characters = document.querySelectorAll('.character');
        characters.forEach(character => {
          const titleElement = character.querySelector('.character-title');
          if (!titleElement) return;
          const namePart = titleElement.textContent.split("-")[0].trim().toLowerCase();
          character.style.display = namePart.startsWith(query) ? "" : "none";
        });
        if (window.innerWidth <= 768) {
          document.querySelectorAll('.section-container').forEach(section => {
            const visibleCharacters = section.querySelectorAll('.character:not([style*="display: none"])');
            section.style.display = visibleCharacters.length === 0 ? "none" : "";
          });
        }
      });
    });
  </script>
</body>
</html>
